!function(n){"use strict";wp.customize.controlConstructor["shopwell-design-options"]=wp.customize.Control.extend({ready:function(){var a,t=this,e=t.setting.get(),i=t.container.find(".popup-content");t.container.find(".shopwell-range-wrapper").each((function(){var a=n(this);_.isUndefined(a.rangeControl)||a.rangeControl({id:t.params.id+"-"+a.data("option-id"),option:a.data("option-id"),value:e[a.data("options-id")],responsive:t.params.responsive,change:function(){t.update_value()}})})),t.container.find("input.shopwell-range-input").on("change keyup",(function(){t.autocorrect_range_input_number(n(this),1e3,a)})).on("focusout",(function(){t.autocorrect_range_input_number(n(this),0,a)})),t.container.on("change",'[data-option="background-type"], [data-option="gradient-type"]',(function(){var a=n(this).attr("data-option");t.container.find('[data-dep-field="'+a+'"]').hide(),t.container.find('[data-dep-field="'+a+'"][data-dep-value="'+n(this).val()+'"]').show()})),t.container.find('[data-option="background-type"], [data-option="gradient-type"]').trigger("change"),t.container.on("color-updated",".shopwell-color-control",(function(){t.update_value()})),t.container.on("change",".shopwell-select-wrapper",(function(){t.update_value()})),t.container.find(".popup-link").on("click",(function(){i.toggleClass("hidden"),n(this).toggleClass("active"),n(this).siblings(".reset-defaults").toggleClass("active"),n("body").on("click",o)}));var o=function(a){n(a.target).closest(".customize-save-button-wrapper").length||t.container.has(n(a.target).closest(".popup-link")).length||t.container.has(n(a.target).closest(".popup-content")).length||i.hasClass("hidden")||n(a.target).closest(".reset-defaults").length||(i.addClass("hidden"),t.container.find(".popup-link").removeClass("active"),t.container.find(".reset-defaults").removeClass("active"),n("body").off("click",o))};t.container.find(".background-image-advanced").hide(),t.container.on("change",".background-repeat select",(function(){t.update_value()})),t.container.on("change click",".background-size input",(function(){t.update_value()})),t.container.on("change click",".background-attachment input",(function(){t.update_value()})),t.container.on("click",".background-image-upload-button",(function(a){n("body").off("click",o);var e=wp.media({multiple:!1,title:t.params.l10n.image.select_image,button:{text:t.params.l10n.image.use_image}}).open().on("select",(function(){var a,i,c,d,r,s=e.state().get("selection").first().toJSON();a=_.isUndefined(s.sizes)?s.url:_.isUndefined(s.sizes.medium)?_.isUndefined(s.sizes.thumbnail)?_.isUndefined(s.sizes.full)?s.url:s.sizes.full.url:s.sizes.thumbnail.url:s.sizes.medium.url,i=s.url,c=s.id,s.width,s.height,""!==i&&(t.container.find(".background-image-advanced").show(),t.container.find(".advanced-settings").removeClass("hidden").addClass("up")),t.container.find('[data-option="background-image"]').val(i),t.container.find('[data-option="background-image-id"]').val(c),t.update_value(),d=t.container.find(".placeholder, .thumbnail"),r=t.container.find(".background-image-upload-remove-button"),d.length&&d.removeClass().addClass("thumbnail thumbnail-image").html('<img src="'+a+'" alt="" />'),r.length&&r.show(),setTimeout((function(){n("body").on("click",o)}),100)}));a.preventDefault()})),t.container.on("click",".background-image-upload-remove-button",(function(n){var a,e;n.preventDefault(),t.container.find('[data-option="background-image"]').val(""),t.container.find('[data-option="background-image-id"]').val(""),t.update_value(),a=t.container.find(".placeholder, .thumbnail"),e=t.container.find(".background-image-upload-remove-button"),t.container.find(".background-image-advanced").hide(),t.container.find(".advanced-settings").addClass("hidden").removeClass("up"),a.length&&a.removeClass().addClass("placeholder").html(t.params.l10n.image.placeholder),e.length&&e.hide()})),t.container.on("click",".advanced-settings",(function(a){n(this).toggleClass("up"),t.container.find(".background-image-advanced").toggle()})),t.container.on("click",".shopwell-spacing-linked",(function(){var a=n(this);a.closest("ul").find(".spacing-input").removeClass("linked"),a.parent(".spacing-link-values").removeClass("unlinked")})),t.container.on("click",".shopwell-spacing-unlinked",(function(){var a=n(this);a.closest("ul").find(".spacing-input").addClass("linked"),a.parent(".spacing-link-values").addClass("unlinked")})),t.container.on("input",".linked input",(function(){var a=n(this).val();n(this).closest(".spacing-input").siblings(".linked").find("input").val(a).change()})),t.container.on("change input",".spacing-input input",(function(){t.update_value()})),t.container.find(".reset-defaults").on("click",(function(){var a,e;t.container.find("[data-option]").each((function(){a=n(this),"background-size"===(e=a.data("option"))||"background-attachment"===e?(a.prop("checked",!1),e in t.params.default&&t.params.default[e]===a.val()&&a.prop("checked",!0)):a.val(t.params.default[a.data("option")]).trigger("change")})),t.container.find(".background-image-upload-remove-button").click(),t.update_value()}))},update_value:function(){var a,t={};this.container.find("[data-option]").each((function(){a=n(this).data("option"),t[a]="background-size"===a||"background-attachment"===a?n(this).is(":checked")?n(this).val():t[a]:n(this).val()})),this.setting.set(t)},autocorrect_range_input_number:function(n,a){var t=n,e=t.parent().find('input[type="range"]'),i=parseFloat(t.val()),o=parseFloat(e.find(".shopwell-reset-range").attr("data-reset_value")),c=parseFloat(t.attr("step")),d=parseFloat(t.attr("min")),r=parseFloat(t.attr("max"));clearTimeout(a),a=setTimeout((function(){if(isNaN(i))return t.val(o),void e.val(o).trigger("change");c>=1&&i%1!=0&&(i=Math.round(i),t.val(i),e.val(i).trigger("change")),i>r&&(t.val(r),e.val(r).trigger("change")),i<d&&(t.val(d),e.val(d).trigger("change"))}),a),e.val(i).trigger("change"),this.update_value()}})}(jQuery);
